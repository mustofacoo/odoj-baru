<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bismillah, One Day One Juz</title>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <script>
        // Supabase Configuration - GANTI DENGAN CREDENTIALS ANDA
        const SUPABASE_URL = 'https://avbfccjifnptszchabjh.supabase.co'
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF2YmZjY2ppZm5wdHN6Y2hhYmpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE2OTQyODMsImV4cCI6MjA2NzI3MDI4M30.Al8QBt2khiS35uG5IkGIJrLtAd1niWUFAbcsx_pBEgU'
        // Initialize Supabase
        let supabase = null;
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
            window.supabaseClient = supabase
            console.log('üü¢ Supabase initialized successfully')
        } catch (error) {
            console.log('üü† Supabase initialization failed, using offline mode')
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
        }
        
        .card-shadow {
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .completed {
            background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
            transform: scale(1.02);
            border: 2px solid #ea580c;
        }
        
        .juz-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid #e5e7eb;
        }
        
        .juz-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            border-color: #ea580c;
        }
        
        .admin-badge {
            background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
        }
        
        .khatam-celebration {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            animation: celebration 0.5s ease-in-out;
        }
        
        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }
        
        .text-primary {
            color: #ea580c;
        }
        
        .bg-primary {
            background-color: #ea580c;
        }
        
        .border-primary {
            border-color: #ea580c;
        }

        /* Mobile optimizations */
        @media (max-width: 768px) {
            .juz-card {
                padding: 1rem;
            }
            
            .grid-mobile {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            
            .text-responsive {
                font-size: 0.875rem;
            }
        }
        
        .modal-backdrop {
            backdrop-filter: blur(4px);
        }
        
        .announcement-modal {
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .export-text {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            white-space: pre-wrap;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            max-height: 400px;
            overflow-y: auto;
        }

        /* Floating Action Buttons */
        .floating-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 40;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .floating-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .floating-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .whatsapp-btn {
            background: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
            color: white;
        }

        .donate-btn {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ea580c;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Edit participant modal */
        .edit-participant-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 12px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .juz-card:hover .edit-participant-btn {
            opacity: 1;
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 50;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .status-online {
            background: #10b981;
            color: white;
        }

        .status-offline {
            background: #ef4444;
            color: white;
        }

        .status-connecting {
            background: #f59e0b;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="quranTracker()" x-init="init()" class="min-h-screen">
        
        <!-- Loading Overlay -->
        <div x-show="isLoading" class="loading-overlay">
            <div class="bg-white rounded-lg p-6 text-center">
                <div class="spinner mx-auto mb-4"></div>
                <p class="text-gray-600" x-text="loadingMessage"></p>
            </div>
        </div>

        <!-- Connection Status -->
        <div class="connection-status" 
             :class="{
                'status-online': connectionStatus === 'online',
                'status-offline': connectionStatus === 'offline', 
                'status-connecting': connectionStatus === 'connecting'
             }"
             x-show="connectionStatus !== 'online'">
            <span x-show="connectionStatus === 'connecting'">üîÑ Menghubungkan...</span>
            <span x-show="connectionStatus === 'offline'">üì± Mode Offline</span>
        </div>

        <!-- Initial Announcement Modal -->
        <div x-show="showAnnouncement" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 modal-backdrop p-4">
            <div class="announcement-modal bg-white rounded-2xl p-6 md:p-8 max-w-lg w-full card-shadow border-t-4 border-primary">
                <div class="text-center">
                    <div class="bg-primary rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4">
                        <span class="text-white text-3xl">üìñ</span>
                    </div>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">üì¢ Selamat Datang!</h2>
                    <div class="text-left bg-orange-50 border-l-4 border-primary p-4 rounded-lg mb-6">
                        <h3 class="font-semibold text-gray-800 mb-2">‚ö†Ô∏è Perhatikan Deskripsi Juz!</h3>
                        <ul class="text-sm text-gray-700 space-y-2">
                            <li>‚Ä¢ <strong>WAJIB</strong> membaca deskripsi juz yang akan dibaca</li>
                            <li>‚Ä¢ Ada beberapa juz yang <strong>tidak sesuai</strong> dengan pembagian halaman mushaf</li>
                            <li>‚Ä¢ Penyesuaian dilakukan untuk <strong>menyesuaikan tema</strong> dan kandungan</li>
                            <li>‚Ä¢ Lihat <strong>halaman dan ayat yang tepat</strong> di setiap kartu juz</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg mb-6 text-left">
                        <h3 class="font-semibold text-blue-800 mb-2">ü§≤ Doa Sebelum Membaca</h3>
                        <p class="text-sm text-blue-700 italic">
                            "Ya Allah, turunkan rahmat kepada kami dengan wasilah bacaan Al-Qur'an. 
                            Jadikan kami lebih mencintai untuk berinteraksi dengan Al-Qur'an daripada berbuat sia-sia. 
                            Anugerahkan kami pemahaman Al-Qur'an dan pengamalannya. 
                            Perkenankan Al-Qur'an memberi syafaat untuk kami di hari kiamat."
                        </p>
                    </div>
                    <button @click="closeAnnouncement()" 
                            class="w-full btn-primary text-white py-3 px-6 rounded-lg font-semibold text-lg hover:bg-red-600 transition-all duration-300">
                        ‚úÖ Alhamdulillah saya paham. Lanjut centang...
                    </button>
                </div>
            </div>
        </div>

        <!-- Edit Participant Modal -->
        <div x-show="showEditParticipant" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
            <div class="bg-white rounded-xl p-6 md:p-8 max-w-md w-full card-shadow"
                 @click.away="showEditParticipant = false">
                <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">‚úèÔ∏è Edit Nama Peserta</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nama Peserta</label>
                        <input x-model="editingParticipant.name" 
                               type="text" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 md:px-4 md:py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm md:text-base"
                               placeholder="Masukkan nama peserta"
                               @keyup.enter="saveParticipantName()">
                    </div>
                </div>
                
                <div class="flex space-x-4 mt-6">
                    <button @click="showEditParticipant = false" 
                            class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all duration-300 text-sm md:text-base">
                        Batal
                    </button>
                    <button @click="saveParticipantName()" 
                            class="flex-1 py-2 px-4 btn-primary text-white rounded-lg hover:bg-red-600 transition-all duration-300 text-sm md:text-base">
                        Simpan
                    </button>
                </div>
            </div>
        </div>

        <!-- Header -->
        <header class="gradient-bg text-white shadow-lg">
            <div class="container mx-auto px-4 py-4 md:py-6">
                <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                    <div class="text-center md:text-left">
                        <h1 class="text-2xl md:text-4xl font-bold">One Day One Juz</h1>
                        <p class="text-orange-100 mt-1 text-sm md:text-base">Istiqomah bersama Al Qur'an</p>
                    </div>
                    <div class="text-center md:text-right">
                        <div x-show="!isAdmin">
                            <button @click="showAdminLogin = true" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-2 md:px-4 md:py-2 rounded-lg transition-all duration-300 text-sm md:text-base">
                                üîë Admin Login
                            </button>
                        </div>
                        <div x-show="isAdmin" class="admin-badge px-3 py-2 md:px-4 md:py-2 rounded-lg">
                            <span class="text-white font-semibold text-sm md:text-base">üëë Mode Admin</span>
                            <button @click="logout()" class="ml-2 text-white hover:text-gray-200 text-sm">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Stats -->
        <div class="container mx-auto px-4 py-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-white rounded-xl p-4 md:p-6 card-shadow">
                    <div class="flex items-center">
                        <div class="bg-primary p-3 rounded-full mr-4 flex-shrink-0">
                            <span class="text-white text-lg md:text-xl">üìÖ</span>
                        </div>
                        <div class="min-w-0 flex-1">
                            <h3 class="text-gray-500 text-xs md:text-sm">Tanggal Hari Ini</h3>
                            <p class="text-sm md:text-xl font-bold text-gray-800 truncate" x-text="getCurrentDate()"></p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 md:p-6 card-shadow">
                    <div class="flex items-center">
                        <div class="bg-green-500 p-3 rounded-full mr-4 flex-shrink-0">
                            <span class="text-white text-lg md:text-xl">‚úÖ</span>
                        </div>
                        <div>
                            <h3 class="text-gray-500 text-xs md:text-sm">Selesai Hari Ini</h3>
                            <p class="text-sm md:text-xl font-bold text-gray-800"><span x-text="getTodayCompleted()"></span>/30</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 md:p-6 card-shadow" :class="{'khatam-celebration': getTodayCompleted() === 30}">
                    <div class="flex items-center">
                        <div class="bg-yellow-500 p-3 rounded-full mr-4 flex-shrink-0">
                            <span class="text-white text-lg md:text-xl">üèÜ</span>
                        </div>
                        <div class="min-w-0 flex-1">
                            <h3 class="text-gray-500 text-xs md:text-sm">Status Khatam</h3>
                            <p class="text-sm md:text-xl font-bold text-gray-800 truncate" x-text="getTodayCompleted() === 30 ? 'KHATAM HARI INI! üéâ' : (30 - getTodayCompleted()) + ' lagi untuk Khatam'"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="container mx-auto px-4 mb-6">
            <div class="bg-white rounded-xl p-2 card-shadow">
                <div class="flex space-x-1 md:space-x-2">
                    <button @click="activeTab = 'checklist'" 
                            :class="activeTab === 'checklist' ? 'bg-primary text-white' : 'text-gray-600 hover:text-primary'"
                            class="flex-1 py-2 md:py-3 px-2 md:px-4 rounded-lg font-semibold transition-all duration-300 text-sm md:text-base">
                        üìã Checklist Harian
                    </button>
                    <button @click="activeTab = 'monthly'" 
                            :class="activeTab === 'monthly' ? 'bg-primary text-white' : 'text-gray-600 hover:text-primary'"
                            class="flex-1 py-2 md:py-3 px-2 md:px-4 rounded-lg font-semibold transition-all duration-300 text-sm md:text-base">
                        üìä Rekap Bulanan
                    </button>
                    <button x-show="isAdmin" @click="activeTab = 'admin'" 
                            :class="activeTab === 'admin' ? 'bg-primary text-white' : 'text-gray-600 hover:text-primary'"
                            class="flex-1 py-2 md:py-3 px-2 md:px-4 rounded-lg font-semibold transition-all duration-300 text-sm md:text-base">
                        üîß Admin
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Content: Checklist Harian -->
        <div x-show="activeTab === 'checklist'" class="container mx-auto px-4 pb-24">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3 md:gap-4">
                <template x-for="(participant, index) in getRotatedParticipants()" :key="participant.id">
                    <div class="juz-card bg-white rounded-xl p-4 md:p-6 card-shadow relative" 
                         :class="{'completed': isCompleted(participant.id)}"
                         @click="toggleCheck(participant.id)">
                        
                        <!-- Edit Button (Admin Only) -->
                        <button x-show="isAdmin" 
                                @click.stop="editParticipant(participant)"
                                class="edit-participant-btn">
                            ‚úèÔ∏è
                        </button>
                        
                        <!-- Juz Header -->
                        <div class="flex justify-between items-start mb-3 md:mb-4">
                            <div>
                                <h3 class="text-base md:text-lg font-bold" :class="isCompleted(participant.id) ? 'text-white' : 'text-gray-800'" x-text="'Juz ' + (index + 1)"></h3>
                                <p class="text-xs md:text-sm" :class="isCompleted(participant.id) ? 'text-orange-100' : 'text-gray-500'" x-text="getJuzDetails(index + 1).name"></p>
                            </div>
                            <div class="text-xl md:text-2xl" x-text="isCompleted(participant.id) ? '‚úÖ' : '‚è≥'"></div>
                        </div>
                        
                        <!-- Participant Info -->
                        <div class="mb-3 md:mb-4">
                            <h4 class="font-semibold text-sm md:text-base" :class="isCompleted(participant.id) ? 'text-white' : 'text-gray-700'" x-text="participant.name"></h4>
                            <p class="text-xs md:text-sm" :class="isCompleted(participant.id) ? 'text-orange-100' : 'text-gray-500'" x-text="'Halaman ' + getJuzDetails(index + 1).pages"></p>
                        </div>
                        
                        <!-- Juz Content -->
                        <div class="mb-3 md:mb-4">
                            <p class="text-xs md:text-sm font-medium" :class="isCompleted(participant.id) ? 'text-orange-100' : 'text-gray-600'" x-text="getJuzDetails(index + 1).content"></p>
                        </div>
                        
                        <!-- Description -->
                        <div class="border-t pt-2 md:pt-3" :class="isCompleted(participant.id) ? 'border-orange-300' : 'border-gray-200'">
                            <p class="text-xs" :class="isCompleted(participant.id) ? 'text-orange-100' : 'text-gray-500'" x-text="getJuzDetails(index + 1).description"></p>
                        </div>
                        
                        <!-- Status -->
                        <div class="mt-3 md:mt-4 text-center">
                            <span class="text-xs md:text-sm font-semibold" :class="isCompleted(participant.id) ? 'text-white' : 'text-gray-500'">
                                <span x-show="isCompleted(participant.id)">‚úÖ Sudah Selesai</span>
                                <span x-show="!isCompleted(participant.id)">‚è≥ Belum Selesai</span>
                            </span>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Tab Content: Rekap Bulanan -->
        <div x-show="activeTab === 'monthly'" class="container mx-auto px-4 pb-24">
            <!-- Month Selection -->
            <div class="bg-white rounded-xl p-4 md:p-6 card-shadow mb-6">
                <div class="flex flex-col md:flex-row md:items-center space-y-2 md:space-y-0 md:space-x-4">
                    <label class="font-semibold text-gray-700 text-sm md:text-base">Pilih Bulan:</label>
                    <select x-model="selectedMonth" @change="updateMonthlyView()" 
                            class="border border-gray-300 rounded-lg px-3 py-2 md:px-4 md:py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm md:text-base">
                        <template x-for="month in availableMonths" :key="month.value">
                            <option :value="month.value" x-text="month.label"></option>
                        </template>
                    </select>
                </div>
            </div>

            <!-- Monthly Stats -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6 mb-6">
                <div class="bg-white rounded-xl p-4 md:p-6 card-shadow">
                    <div class="flex items-center">
                        <div class="bg-yellow-500 p-3 md:p-4 rounded-full mr-4 flex-shrink-0">
                            <span class="text-white text-xl md:text-2xl">üèÜ</span>
                        </div>
                        <div>
                            <h3 class="text-gray-500 text-xs md:text-sm">Total Khatam Bulan Ini</h3>
                            <p class="text-2xl md:text-3xl font-bold text-yellow-600" x-text="getMonthlyKhatam() + ' kali'"></p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl p-4 md:p-6 card-shadow">
                    <div class="flex items-center">
                        <div class="bg-primary p-3 md:p-4 rounded-full mr-4 flex-shrink-0">
                            <span class="text-white text-xl md:text-2xl">üìä</span>
                        </div>
                        <div>
                            <h3 class="text-gray-500 text-xs md:text-sm">Total Partisipasi</h3>
                            <p class="text-2xl md:text-3xl font-bold text-primary" x-text="getTotalMonthlyChecks()"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monthly Progress Table -->
            <div class="bg-white rounded-xl card-shadow overflow-hidden">
                <div class="p-4 md:p-6 border-b border-gray-200">
                    <h3 class="text-lg md:text-xl font-bold text-gray-800">Progress Peserta</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Peserta</th>
                                <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Jumlah Centang</th>
                                <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Persentase</th>
                                <th class="px-3 md:px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Progress Bar</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="participant in participants" :key="participant.id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                                        <div class="text-xs md:text-sm font-medium text-gray-900" x-text="participant.name"></div>
                                    </td>
                                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                                        <div class="text-xs md:text-sm text-gray-900" x-text="getParticipantMonthlyCount(participant.id) + '/' + getDaysInMonth()"></div>
                                    </td>
                                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                                        <div class="text-xs md:text-sm text-gray-900" x-text="Math.round((getParticipantMonthlyCount(participant.id) / getDaysInMonth()) * 100) + '%'"></div>
                                    </td>
                                    <td class="px-3 md:px-6 py-4 whitespace-nowrap">
                                        <div class="w-full bg-gray-200 rounded-full h-2">
                                            <div class="bg-primary h-2 rounded-full transition-all duration-500" 
                                                 :style="'width: ' + Math.round((getParticipantMonthlyCount(participant.id) / getDaysInMonth()) * 100) + '%'"></div>
                                        </div>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Tab Content: Admin -->
        <div x-show="activeTab === 'admin' && isAdmin" class="container mx-auto px-4 pb-24">
            <div class="bg-white rounded-xl p-4 md:p-6 card-shadow">
                <h3 class="text-lg md:text-xl font-bold text-gray-800 mb-6">üîß Panel Admin</h3>
                
                <div class="space-y-6">
                    <!-- Export WhatsApp Data -->
                    <div class="border border-gray-200 rounded-lg p-4 md:p-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">üì§ Ekspor Data WhatsApp</h4>
                        <p class="text-sm text-gray-600 mb-4">
                            Export data progress hari ini dalam format yang siap untuk dibagikan ke berbagai grup.
                        </p>
                        
                        <button @click="generateWhatsAppExport()" 
                                class="btn-primary text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all duration-300 text-sm font-semibold">
                            üì± Kirim laporan ke Grup Odoj
                        </button>
                        
                        <div x-show="exportText" class="mt-4">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-sm font-medium text-gray-700">Hasil Export (Copy & Paste ke WhatsApp):</label>
                                <button @click="copyToClipboard()" 
                                        class="text-xs px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all">
                                    üìã Copy
                                </button>
                            </div>
                            <div class="export-text" x-text="exportText"></div>
                            <p class="text-xs text-gray-500 mt-2">
                                ‚úÖ Data berhasil di-generate! Klik "Copy" lalu paste ke WhatsApp grup.
                            </p>
                        </div>
                    </div>

                    <!-- Reset System -->
                    <div class="border border-red-200 rounded-lg p-4 md:p-6 bg-red-50">
                        <h4 class="text-lg font-semibold text-red-800 mb-3">üîÑ Reset Sistem</h4>
                        <p class="text-sm text-red-700 mb-4">
                            <strong>Peringatan:</strong> Ini akan menghapus semua data progress dan mengembalikan sistem ke kondisi awal.
                        </p>
                        
                        <button @click="resetSystem()" 
                                class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-all duration-300 text-sm font-semibold">
                            üóëÔ∏è Reset Semua Data
                        </button>
                    </div>

                    <!-- Data Info -->
                    <div class="border border-blue-200 rounded-lg p-4 md:p-6 bg-blue-50">
                        <h4 class="text-lg font-semibold text-blue-800 mb-3">üíæ Informasi Data</h4>
                        <div class="space-y-2 text-sm">
                            <p><strong>Status Koneksi:</strong> 
                                <span :class="supabaseConnected ? 'text-green-600' : 'text-orange-600'" 
                                      x-text="supabaseConnected ? 'üü¢ Supabase Connected' : 'üü† Offline Mode'"></span>
                            </p>
                            <p><strong>Penyimpanan:</strong> 
                                <span x-text="supabaseConnected ? 'Supabase + Local Backup' : 'Local Storage Browser'"></span>
                            </p>
                            <p><strong>Real-time Sync:</strong> 
                                <span :class="supabaseConnected ? 'text-green-600' : 'text-red-600'" 
                                      x-text="supabaseConnected ? '‚úÖ Aktif' : '‚ùå Nonaktif'"></span>
                            </p>
                            <p><strong>Total Peserta:</strong> <span x-text="participants.length"></span></p>
                            <div x-show="supabaseConnected" class="mt-2 p-2 bg-green-50 rounded">
                                <p class="text-green-700 text-xs">
                                    <strong>üîÑ Multi-Device:</strong> Centang dari device manapun akan sync otomatis ke semua device lain.
                                </p>
                            </div>
                            <div x-show="!supabaseConnected" class="mt-2 p-2 bg-orange-50 rounded">
                                <p class="text-orange-700 text-xs">
                                    <strong>üì± Single Device:</strong> Data tersimpan lokal di browser ini saja. Setup Supabase untuk multi-device sync.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Login Modal -->
        <div x-show="showAdminLogin" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-4">
            <div class="bg-white rounded-xl p-6 md:p-8 max-w-md w-full card-shadow"
                 @click.away="showAdminLogin = false">
                <h3 class="text-xl md:text-2xl font-bold text-gray-800 mb-6">üîë Admin Login</h3>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input x-model="adminCredentials.username" 
                               type="text" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 md:px-4 md:py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm md:text-base"
                               placeholder="Masukkan username">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                        <input x-model="adminCredentials.password" 
                               type="password" 
                               class="w-full border border-gray-300 rounded-lg px-3 py-2 md:px-4 md:py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm md:text-base"
                               placeholder="Masukkan password"
                               @keyup.enter="adminLogin()">
                    </div>
                </div>
                
                <div x-show="adminError" class="mt-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded-lg text-sm" x-text="adminError"></div>
                
                <div class="flex space-x-4 mt-6">
                    <button @click="showAdminLogin = false" 
                            class="flex-1 py-2 px-4 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-all duration-300 text-sm md:text-base">
                        Batal
                    </button>
                    <button @click="adminLogin()" 
                            class="flex-1 py-2 px-4 btn-primary text-white rounded-lg hover:bg-red-600 transition-all duration-300 text-sm md:text-base">
                        Login
                    </button>
                </div>
            </div>
        </div>

        <!-- Floating Action Buttons -->
        <div class="floating-buttons">
            <a href="https://wa.me/6281334989001?text=Assalamu'alaikum, saya ingin bertanya-tanya tentang (isi topik pertanyaan...)" 
               target="_blank" 
               class="floating-btn whatsapp-btn" 
               title="Tanya Jawab WhatsApp">
                <span class="text-xl">üí¨</span>
            </a>
            <a href="https://sites.google.com/view/keluargaquran/home" 
               target="_blank"
               class="floating-btn donate-btn" 
               title="Infaq">
                <span class="text-xl">üíù</span>
            </a>
        </div>
    </div>

    <script>
        function quranTracker() {
            return {
                // Connection state
                connectionStatus: 'connecting',
                supabaseConnected: false,
                
                // UI state
                isLoading: true,
                loadingMessage: 'Memuat aplikasi...',
                showAnnouncement: false,
                showEditParticipant: false,
                editingParticipant: { id: null, name: '' },
                
                // Data peserta
                participants: [
                    { id: 1, name: 'Ahmad' }, { id: 2, name: 'Fatimah' }, { id: 3, name: 'Abdullah' }, { id: 4, name: 'Khadijah' },
                    { id: 5, name: 'Umar' }, { id: 6, name: 'Aisha' }, { id: 7, name: 'Ali' }, { id: 8, name: 'Zainab' },
                    { id: 9, name: 'Yusuf' }, { id: 10, name: 'Maryam' }, { id: 11, name: 'Ibrahim' }, { id: 12, name: 'Hafsa' },
                    { id: 13, name: 'Khalid' }, { id: 14, name: 'Ruqayyah' }, { id: 15, name: 'Hamza' }, { id: 16, name: 'Ummu Kulthum' },
                    { id: 17, name: 'Bilal' }, { id: 18, name: 'Safiyyah' }, { id: 19, name: 'Salman' }, { id: 20, name: 'Sawdah' },
                    { id: 21, name: 'Talhah' }, { id: 22, name: 'Maymunah' }, { id: 23, name: 'Zaid' }, { id: 24, name: 'Juwayriyyah' },
                    { id: 25, name: 'Anas' }, { id: 26, name: 'Zaynab bint Jahsh' }, { id: 27, name: 'Mu\'adh' }, { id: 28, name: 'Ramlah' },
                    { id: 29, name: 'Sa\'d' }, { id: 30, name: 'Habibah' }
                ],

                // Detail setiap juz
                juzDetails: {
                    1: { name: "Al Fatihah", content: "Al-Fatihah - Al-Baqarah:141", pages: "1-21", description: "Doa meminta petunjuk (Al-Fatihah), ciri orang bertakwa, kisah Bani Israil sebagai pelajaran bagi umat Islam." },
                    2: { name: " ÿ≥ŸéŸäŸéŸÇŸèŸàŸÑŸè Ÿ±ŸÑÿ≥ŸèŸëŸÅŸéŸáŸéÿ¢ÿ°Ÿè", content: "Al-Baqarah:142-252", pages: "22-41", description: "Perintah puasa Ramadhan, hukum qishash, infaq, dan jihad. Keutamaan sabar dan kesatuan arah ibadah." },
                    3: { name: "€û ÿ™ŸêŸÑŸíŸÉŸé Ÿ±ŸÑÿ±ŸèŸëÿ≥ŸèŸÑŸè ŸÅŸéÿ∂ŸéŸëŸÑŸíŸÜŸéÿß", content: "Al-Baqarah:253 - Ali Imran:92", pages: "42-61", description: "Kisah Nabi Musa, Nabi Isa, dan perjuangan para nabi. Anjuran bersedekah dan meninggalkan riba." },
                    4: { name: " ŸÉŸèŸÑŸèŸë Ÿ±ŸÑÿ∑ŸéŸëÿπŸéÿßŸÖŸê", content: "Ali Imran:93 - An-Nisa:23", pages: "62-82", description: "Perang Uhud, akhlak dalam kemenangan dan kekalahan, serta tanggung jawab individu." },
                    5: { name: "ÿ≠Ÿèÿ±ŸêŸëŸÖŸéÿ™Ÿí ÿπŸéŸÑŸéŸäŸíŸÉŸèŸÖŸí", content: "An-Nisa:24-147", pages: "82-101", description: "Warisan, poligami, perlindungan anak yatim, loyalitas kepada Allah dan Rasul-Nya." },
                    6: { name: " ŸÑŸéŸëÿß ŸäŸèÿ≠Ÿêÿ®ŸèŸë Ÿ±ŸÑŸÑŸéŸëŸáŸè", content: "An-Nisa:148 - Al-Maidah:81", pages: "101-121", description: "Larangan berbuat zalim, hukum halal-haram, dan kisah Bani Israil yang ingkar." },
                    7: { name: "€û ŸÑŸéÿ™Ÿéÿ¨ŸêÿØŸéŸÜŸéŸë ÿ£Ÿéÿ¥ŸéÿØŸéŸë Ÿ±ŸÑŸÜŸéŸëÿßÿ≥Ÿê", content: "Al-Maidah:82 - Al-An'am:107", pages: "122-141", description: "Pujian untuk ahli kitab yang beriman dan dalil-dalil tentang keesaan Allah." },
                    8: { name: "ŸàŸéŸÑŸéÿß ÿ™Ÿéÿ≥Ÿèÿ®ŸèŸëŸàÿß€ü Ÿ±ŸÑŸéŸëÿ∞ŸêŸäŸÜŸé", content: "Al-An'am:108 - Al-A'raf:84", pages: "141-161", description: "Bantahan terhadap orang musyrik dan kisah para nabi dalam berdakwah." },
                    9: { name: "ŸàŸéÿ•ŸêŸÑŸéŸâŸ∞ ŸÖŸéÿØŸíŸäŸéŸÜŸé ÿ£ŸéÿÆŸéÿßŸáŸèŸÖŸí", content: "Al-A'raf:85 - Al-Anfal:40", pages: "161-181", description: "Lanjutan kisah para nabi dan perang Badr sebagai pertolongan Allah." },
                    10: { name: "€û ŸàŸéŸ±ÿπŸíŸÑŸéŸÖŸèŸàŸìÿß€ü ÿ£ŸéŸÜŸéŸëŸÖŸéÿß", content: "Al-Anfal:41 - At-Taubah:89", pages: "182-201", description: "Hukum pembagian ghanimah, perang Tabuk, dan sikap terhadap orang munafik." },
                    11: { name: "ŸàŸéÿ¨Ÿéÿ¢ÿ°Ÿé Ÿ±ŸÑŸíŸÖŸèÿπŸéÿ∞ŸêŸëÿ±ŸèŸàŸÜŸé", content: "At-Taubah:90 - Yunus:109", pages: "201-221", description: "Sikap terhadap orang yang tidak ikut jihad dan kisah Nabi Yunus AS." },
                    12: { name: "ÿßŸÑŸìÿ± €ö ŸÉŸêÿ™ŸéŸÄŸ∞ÿ®Ÿå ÿ£Ÿèÿ≠ŸíŸÉŸêŸÖŸéÿ™Ÿí", content: "Hud:1 - Yusuf:57", pages: "222-242", description: "Kisah Nabi Nuh, Hud, Shalih, dan Yusuf sebagai teladan dalam ujian hidup." },
                    13: { name: "ŸàŸéÿ¨Ÿéÿ¢ÿ°Ÿé ÿ•ŸêÿÆŸíŸàŸéÿ©Ÿè ŸäŸèŸàÿ≥ŸèŸÅŸé", content: "Yusuf:58 - Ibrahim:52", pages: "242-261", description: "Lanjutan kisah Yusuf AS di Mesir dan kisah Ibrahim AS dengan kaumnya." },
                    14: { name: "ÿßŸÑŸìÿ± €ö ÿ™ŸêŸÑŸíŸÉŸé ÿ°ŸéÿßŸäŸéŸÄŸ∞ÿ™Ÿè", content: "Al-Hijr:1 - An-Nahl:128", pages: "262-281", description: "Azab untuk kaum yang mendustakan dan nikmat-nikmat Allah yang tak terhitung." },
                    15: { name: "ÿ≥Ÿèÿ®Ÿíÿ≠ŸéŸÄŸ∞ŸÜŸé Ÿ±ŸÑŸéŸëÿ∞ŸêŸâŸì ÿ£Ÿéÿ≥Ÿíÿ±ŸéŸâŸ∞", content: "Al-Isra:1 - Al-Kahf:82", pages: "281-302", description: "Isra Mi'raj, kisah Ashab al-Kahf, dan Dzulqarnain." },
                    16: { name: "ŸàŸéŸäŸéÿ≥ŸíŸÄŸéŸîŸÑŸèŸàŸÜŸéŸÉŸé ÿπŸéŸÜ ÿ∞ŸêŸâ Ÿ±ŸÑŸíŸÇŸéÿ±ŸíŸÜŸéŸäŸíŸÜŸê €ñ", content: "Al-Kahf:83 - Taha:135", pages: "302-321", description: "Kisah Musa dan Khidr, serta Musa AS dengan Fir'aun." },
                    17: { name: "Ÿ±ŸÇŸíÿ™Ÿéÿ±Ÿéÿ®Ÿé ŸÑŸêŸÑŸÜŸéŸëÿßÿ≥Ÿê", content: "Al-Anbiya:1 - Al-Hajj:78", pages: "322-341", description: "Kisah para nabi dan keutamaan ibadah haji." },
                    18: { name: "ŸÇŸéÿØŸí ÿ£ŸéŸÅŸíŸÑŸéÿ≠Ÿé Ÿ±ŸÑŸíŸÖŸèÿ§ŸíŸÖŸêŸÜŸèŸàŸÜŸé", content: "Al-Mu'minun:1 - Al-Furqan:20", pages: "342-361", description: "Sifat-sifat orang mukmin dan kritik terhadap orang kafir." },
                    19: { name: "€û ŸàŸéŸÇŸéÿßŸÑŸé Ÿ±ŸÑŸéŸëÿ∞ŸêŸäŸÜŸé ŸÑŸéÿß ŸäŸéÿ±Ÿíÿ¨ŸèŸàŸÜŸé", content: "Al-Furqan:21 - An-Naml:58", pages: "362-382", description: "Bantahan terhadap orang kafir dan kisah Nabi Sulaiman AS." },
                    20: { name: "ŸÇŸèŸÑŸê Ÿ±ŸÑŸíÿ≠ŸéŸÖŸíÿØŸè ŸÑŸêŸÑŸéŸëŸáŸê", content: "An-Naml:59 - Al-Ankabut:44", pages: "382-402", description: "Kisah Luth AS dan nasihat untuk beribadah kepada Allah." },
                    21: { name: "€û ÿßÿ™ŸíŸÑŸè ŸÖŸéÿß ÿ£ŸèŸàÿ≠ŸêŸäŸé ÿ•ŸêŸÑŸéŸäŸíŸÉŸé", content: "Al-Ankabut:45 - Al-Ahzab:27", pages: "402-422", description: "Ujian bagi orang beriman dan perang Ahzab." },
                    22: { name: "ŸäŸéÿß ÿ£ŸéŸäŸèŸëŸáŸéÿß ÿßŸÑŸÜŸéŸëÿ®ŸêŸäŸèŸë ŸÇŸèŸÑ ŸÑŸêŸëÿ£Ÿéÿ≤ŸíŸàŸéÿßÿ¨ŸêŸÉŸé ", content: "Al-Ahzab:28 - Akhir Fathir", pages: "422-440", description: "Akhlak Nabi Muhammad Ô∑∫, etika rumah tangga Nabi, dan seruan kepada manusia." },
                    23: { name: "Ÿäÿ≥Ÿì ", content: "Yasin:1 - Az-Zumar:31", pages: "440-461", description: "Hari pembalasan, pentingnya amal shalih dan ikhlas dalam beribadah." },
                    24: { name: "€û ŸÅŸéŸÖŸéŸÜŸí ÿ£Ÿéÿ∏ŸíŸÑŸéŸÖŸè ŸÖŸêŸÖŸéŸëŸÜ ŸÉŸéÿ∞Ÿéÿ®Ÿé", content: "Az-Zumar:32 - Akhir Fushshilat", pages: "462-482", description: "Balasan bagi orang yang berbuat zalim dan tanda-tanda kekuasaan Allah." },
                    25: { name: "ÿ≠ŸÖŸì ", content: "Asy Syura:1 - Al-Jatsiyah:37", pages: "482-502", description: "Semua urusan dikembalikan kepada Allah dan hari pembalasan." },
                    26: { name: "ÿ≠ŸÖŸì", content: "Al-Ahqaf:1 - akhir Ath Thur", pages: "502-520", description: "Awal surah-surah Ha Mim dan janji Allah kepada Ibrahim AS." },
                    27: { name: "ŸàŸéŸ±ŸÑÿ∞ŸéŸëŸ∞ÿ±ŸêŸäŸéŸÄŸ∞ÿ™Ÿê ÿ∞Ÿéÿ±ŸíŸàŸã€≠ÿß", content: "Adz-Dzariyat:1 - Al-Hadid:29", pages: "520-541", description: "Lanjutan kisah Ibrahim AS dan keutamaan beriman kepada Allah dan Rasul-Nya." },
                    28: { name: "ŸÇŸéÿØŸí ÿ≥ŸéŸÖŸêÿπŸé Ÿ±ŸÑŸÑŸéŸëŸáŸè", content: "Al-Mujadilah:1 - At-Tahrim:12", pages: "542-561", description: "Adab sosial, larangan menggunjing, ukhuwah, dan keteladanan para istri nabi." },
                    29: { name: "ÿ™Ÿéÿ®ŸéŸÄŸ∞ÿ±ŸéŸÉŸé Ÿ±ŸÑŸéŸëÿ∞ŸêŸâ", content: "Al-Mulk:1 - Al-Mursalat:50", pages: "562-581", description: "Kebesaran Allah dan ancaman bagi orang yang mendustakan hari pembalasan." },
                    30: { name: "ÿπŸéŸÖŸéŸë ŸäŸéÿ™Ÿéÿ≥Ÿéÿ¢ÿ°ŸéŸÑŸèŸàŸÜŸé", content: "An-Naba:1 - An-Nas:6", pages: "582-604", description: "Hari kiamat, surga, neraka, dan perlindungan Allah dari godaan syaitan." }
                },

                // State management
                activeTab: 'checklist',
                todayChecks: {},
                monthlyData: {}, // Format: { "2025-07": { participantChecks: { 1: ["2025-07-01", "2025-07-02"], 2: [...] }, khatamDays: ["2025-07-01"] } }
                selectedMonth: '',
                availableMonths: [],
                
                // Admin
                isAdmin: false,
                showAdminLogin: false,
                adminCredentials: { username: '', password: '' },
                adminError: '',
                exportText: '',
                
                // Program start date
                programStartDate: new Date('2025-07-01'),

                async init() {
                    console.log('üöÄ Starting One Day One Juz App...');
                    this.loadingMessage = 'Memulai aplikasi...';
                    
                    try {
                        // Test Supabase connection with timeout
                        this.loadingMessage = 'Mencoba koneksi Supabase...';
                        await this.testSupabaseConnection();
                        
                        // Load data from Supabase
                        this.loadingMessage = 'Memuat data dari Supabase...';
                        await this.loadDataFromSupabase();
                        
                        this.connectionStatus = 'online';
                        this.supabaseConnected = true;
                        console.log('‚úÖ Supabase mode activated');
                        
                    } catch (error) {
                        console.log('üü† Supabase connection failed, using offline mode:', error.message);
                        this.connectionStatus = 'offline';
                        this.supabaseConnected = false;
                        
                        // Fallback to localStorage
                        this.loadingMessage = 'Mode offline - memuat data lokal...';
                        this.loadDataFromLocal();
                    }
                    
                    // Check announcement
                    this.loadingMessage = 'Menyiapkan pengumuman...';
                    this.checkAnnouncementStatus();
                    
                    // Setup months
                    this.loadingMessage = 'Menyiapkan data bulanan...';
                    this.generateAvailableMonths();
                    this.selectedMonth = this.getCurrentMonth();
                    
                    // Initialize monthly data structure
                    this.loadingMessage = 'Menginisialisasi struktur data bulanan...';
                    this.initializeMonthlyData();
                    
                    // Final setup
                    this.loadingMessage = 'Menyelesaikan setup...';
                    await this.delay(500);
                    
                    this.isLoading = false;
                    console.log('‚úÖ App loaded successfully');
                    console.log('üìä Monthly data structure:', this.monthlyData);
                },

                delay(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                },

                async testSupabaseConnection() {
                    if (!window.supabaseClient) {
                        throw new Error('Supabase client not available');
                    }
                    
                    // Create timeout promise
                    const timeoutPromise = new Promise((_, reject) =>
                        setTimeout(() => reject(new Error('Connection timeout')), 3000)
                    );
                    
                    // Test connection promise
                    const testPromise = window.supabaseClient
                        .from('participants')
                        .select('count')
                        .limit(1);
                    
                    const { data, error } = await Promise.race([testPromise, timeoutPromise]);
                    
                    if (error) {
                        throw new Error(`Supabase connection failed: ${error.message}`);
                    }
                    
                    console.log('‚úÖ Supabase connection successful');
                    return true;
                },

                async loadDataFromSupabase() {
                    try {
                        // Load participants
                        const { data: participants, error: participantsError } = await window.supabaseClient
                            .from('participants')
                            .select('*')
                            .order('id');
                            
                        if (participantsError) throw participantsError;
                        if (participants && participants.length > 0) {
                            this.participants = participants;
                        }

                        // Load today's checks
                        const today = this.getTodayKey();
                        const { data: todayChecks, error: checksError } = await window.supabaseClient
                            .from('daily_checks')
                            .select('participant_id')
                            .eq('check_date', today);
                            
                        if (checksError) throw checksError;
                        
                        this.todayChecks = {};
                        this.todayChecks[today] = todayChecks ? todayChecks.map(check => check.participant_id) : [];

                        // Load monthly data from Supabase (if exists)
                        const { data: monthlyRecords, error: monthlyError } = await window.supabaseClient
                            .from('monthly_records')
                            .select('*');
                            
                        if (monthlyError) throw monthlyError;
                        
                        // Reconstruct monthly data structure
                        if (monthlyRecords && monthlyRecords.length > 0) {
                            this.monthlyData = {};
                            monthlyRecords.forEach(record => {
                                if (!this.monthlyData[record.month]) {
                                    this.monthlyData[record.month] = {
                                        participantChecks: {},
                                        khatamDays: []
                                    };
                                }
                                
                                if (record.participant_id) {
                                    if (!this.monthlyData[record.month].participantChecks[record.participant_id]) {
                                        this.monthlyData[record.month].participantChecks[record.participant_id] = [];
                                    }
                                    this.monthlyData[record.month].participantChecks[record.participant_id].push(record.check_date);
                                }
                                
                                if (record.is_khatam && !this.monthlyData[record.month].khatamDays.includes(record.check_date)) {
                                    this.monthlyData[record.month].khatamDays.push(record.check_date);
                                }
                            });
                        }

                        console.log('‚úÖ Data loaded from Supabase');
                        
                    } catch (error) {
                        console.error('Error loading data from Supabase:', error);
                        throw error;
                    }
                },

                loadDataFromLocal() {
                    try {
                        console.log('üì¶ Loading data from localStorage...');
                        
                        // Load today's checks
                        const todayChecks = localStorage.getItem('quranTrackerTodayChecks');
                        if (todayChecks) {
                            this.todayChecks = JSON.parse(todayChecks);
                        }
                        
                        // Load monthly data
                        const monthlyData = localStorage.getItem('quranTrackerMonthlyData');
                        if (monthlyData) {
                            this.monthlyData = JSON.parse(monthlyData);
                        }
                        
                        // Load participants
                        const participants = localStorage.getItem('quranTrackerParticipants');
                        if (participants) {
                            this.participants = JSON.parse(participants);
                        }
                        
                        console.log('‚úÖ Local data loaded successfully');
                        
                    } catch (error) {
                        console.error('‚ùå Error loading local data:', error);
                        this.todayChecks = {};
                        this.monthlyData = {};
                    }
                },

                initializeMonthlyData() {
                    const currentMonth = this.getCurrentMonth();
                    
                    // Initialize current month if not exists
                    if (!this.monthlyData[currentMonth]) {
                        this.monthlyData[currentMonth] = {
                            participantChecks: {},
                            khatamDays: []
                        };
                        
                        // Initialize all participants for current month
                        this.participants.forEach(participant => {
                            this.monthlyData[currentMonth].participantChecks[participant.id] = [];
                        });
                    }
                    
                    console.log('üìä Monthly data initialized for', currentMonth);
                },

                checkAnnouncementStatus() {
                    const today = this.getTodayKey();
                    const lastSeen = localStorage.getItem('announcementLastSeen');
                    
                    if (lastSeen !== today) {
                        this.showAnnouncement = true;
                    }
                },

                closeAnnouncement() {
                    this.showAnnouncement = false;
                    const today = this.getTodayKey();
                    localStorage.setItem('announcementLastSeen', today);
                },

                editParticipant(participant) {
                    this.editingParticipant = { ...participant };
                    this.showEditParticipant = true;
                },

                async saveParticipantName() {
                    if (!this.editingParticipant.name.trim()) {
                        alert('Nama peserta tidak boleh kosong!');
                        return;
                    }
                    
                    const index = this.participants.findIndex(p => p.id === this.editingParticipant.id);
                    if (index !== -1) {
                        this.participants[index].name = this.editingParticipant.name.trim();
                        
                        // Save to Supabase if connected
                        if (this.supabaseConnected) {
                            try {
                                const { error } = await window.supabaseClient
                                    .from('participants')
                                    .update({ name: this.editingParticipant.name.trim() })
                                    .eq('id', this.editingParticipant.id);
                                    
                                if (error) throw error;
                                console.log('‚úÖ Participant name updated in Supabase');
                            } catch (error) {
                                console.error('Error updating participant:', error);
                                alert('Gagal menyimpan ke server, tersimpan di local saja');
                            }
                        }
                        
                        this.saveData();
                        this.showEditParticipant = false;
                        this.editingParticipant = { id: null, name: '' };
                    }
                },

                // FIXED TIMEZONE FUNCTIONS
                getCurrentDate() {
                    const now = new Date();
                    const jakartaTime = new Date(now.getTime() + (7 * 60 * 60 * 1000));
                    return jakartaTime.toLocaleDateString('id-ID', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                },

                getCurrentMonth() {
                    const now = new Date();
                    const jakartaTime = new Date(now.getTime() + (7 * 60 * 60 * 1000));
                    return jakartaTime.toISOString().slice(0, 7);
                },

                getTodayKey() {
                    const now = new Date();
                    const jakartaTime = new Date(now.getTime() + (7 * 60 * 60 * 1000));
                    return jakartaTime.toISOString().slice(0, 10);
                },

                getDaysInMonth(monthString = null) {
                    const targetMonth = monthString || this.selectedMonth;
                    if (!targetMonth) return 31;
                    const [year, month] = targetMonth.split('-');
                    return new Date(year, month, 0).getDate();
                },

                getDaysSinceStart() {
                    const now = new Date();
                    const jakartaTime = new Date(now.getTime() + (7 * 60 * 60 * 1000));
                    const programStart = new Date('2025-07-01T00:00:00+07:00');
                    const diffTime = jakartaTime - programStart;
                    return Math.floor(diffTime / (1000 * 60 * 60 * 24));
                },

                getRotatedParticipants() {
                    const daysSinceStart = this.getDaysSinceStart();
                    const rotated = [...this.participants];
                    
                    for (let i = 0; i < daysSinceStart % 30; i++) {
                        rotated.unshift(rotated.pop());
                    }
                    
                    return rotated;
                },

                getJuzDetails(juzNumber) {
                    return this.juzDetails[juzNumber] || { 
                        name: 'Unknown', 
                        content: 'Unknown', 
                        pages: 'Unknown',
                        description: 'Deskripsi tidak tersedia'
                    };
                },

                isCompleted(participantId) {
                    const today = this.getTodayKey();
                    return this.todayChecks[today]?.includes(participantId) || false;
                },

                async toggleCheck(participantId) {
                    const today = this.getTodayKey();
                    const currentMonth = this.getCurrentMonth();
                    
                    // Ensure today's checks array exists
                    if (!this.todayChecks[today]) {
                        this.todayChecks[today] = [];
                    }
                    
                    // Ensure monthly data structure exists
                    if (!this.monthlyData[currentMonth]) {
                        this.monthlyData[currentMonth] = {
                            participantChecks: {},
                            khatamDays: []
                        };
                    }
                    
                    // Ensure participant exists in monthly data
                    if (!this.monthlyData[currentMonth].participantChecks[participantId]) {
                        this.monthlyData[currentMonth].participantChecks[participantId] = [];
                    }
                    
                    const index = this.todayChecks[today].indexOf(participantId);
                    const isCurrentlyChecked = index > -1;
                    
                    // Update local state for today's checks
                    if (isCurrentlyChecked) {
                        this.todayChecks[today].splice(index, 1);
                    } else {
                        this.todayChecks[today].push(participantId);
                    }
                    
                    // Update monthly records
                    const monthlyChecks = this.monthlyData[currentMonth].participantChecks[participantId];
                    const monthlyIndex = monthlyChecks.indexOf(today);
                    
                    if (isCurrentlyChecked) {
                        // Remove from monthly record
                        if (monthlyIndex > -1) {
                            monthlyChecks.splice(monthlyIndex, 1);
                        }
                    } else {
                        // Add to monthly record (avoid duplicates)
                        if (monthlyIndex === -1) {
                            monthlyChecks.push(today);
                        }
                    }
                    
                    // Update khatam status
                    this.updateKhatamStatus(today, currentMonth);
                    
                    // Save to Supabase if connected
                    if (this.supabaseConnected) {
                        try {
                            if (isCurrentlyChecked) {
                                // Remove check from Supabase
                                const { error } = await window.supabaseClient
                                    .from('daily_checks')
                                    .delete()
                                    .eq('participant_id', participantId)
                                    .eq('check_date', today);
                                    
                                if (error) throw error;
                                
                                // Remove from monthly_records
                                await window.supabaseClient
                                    .from('monthly_records')
                                    .delete()
                                    .eq('participant_id', participantId)
                                    .eq('check_date', today)
                                    .eq('month', currentMonth);
                                    
                                console.log('‚úÖ Check removed from Supabase');
                            } else {
                                // Add check to Supabase
                                const { error } = await window.supabaseClient
                                    .from('daily_checks')
                                    .insert({
                                        participant_id: participantId,
                                        check_date: today
                                    });
                                    
                                if (error) throw error;
                                
                                // Add to monthly_records
                                await window.supabaseClient
                                    .from('monthly_records')
                                    .upsert({
                                        month: currentMonth,
                                        check_date: today,
                                        participant_id: participantId,
                                        is_khatam: false
                                    });
                                    
                                console.log('‚úÖ Check added to Supabase');
                            }
                        } catch (error) {
                            console.error('Error syncing with Supabase:', error);
                            // Revert local changes if Supabase fails
                            if (isCurrentlyChecked) {
                                this.todayChecks[today].push(participantId);
                                if (monthlyIndex === -1) {
                                    monthlyChecks.push(today);
                                }
                            } else {
                                const revertIndex = this.todayChecks[today].indexOf(participantId);
                                if (revertIndex > -1) {
                                    this.todayChecks[today].splice(revertIndex, 1);
                                }
                                if (monthlyIndex > -1) {
                                    monthlyChecks.splice(monthlyIndex, 1);
                                }
                            }
                            alert('Gagal sinkronisasi dengan server. Coba lagi.');
                            return;
                        }
                    }
                    
                    this.saveData();
                },

                updateKhatamStatus(date, month) {
                    const completedCount = this.todayChecks[date]?.length || 0;
                    const khatamDays = this.monthlyData[month].khatamDays;
                    const isKhatamDay = khatamDays.includes(date);
                    
                    if (completedCount === 30 && !isKhatamDay) {
                        // Add khatam day
                        khatamDays.push(date);
                        
                        // Save to Supabase if connected
                        if (this.supabaseConnected) {
                            window.supabaseClient
                                .from('monthly_records')
                                .upsert({
                                    month: month,
                                    check_date: date,
                                    participant_id: null,
                                    is_khatam: true
                                })
                                .then(({ error }) => {
                                    if (error) console.error('Error saving khatam status:', error);
                                });
                        }
                        
                    } else if (completedCount < 30 && isKhatamDay) {
                        // Remove khatam day
                        const index = khatamDays.indexOf(date);
                        if (index > -1) {
                            khatamDays.splice(index, 1);
                        }
                        
                        // Remove from Supabase if connected
                        if (this.supabaseConnected) {
                            window.supabaseClient
                                .from('monthly_records')
                                .delete()
                                .eq('month', month)
                                .eq('check_date', date)
                                .eq('is_khatam', true)
                                .then(({ error }) => {
                                    if (error) console.error('Error removing khatam status:', error);
                                });
                        }
                    }
                },

                getTodayCompleted() {
                    const today = this.getTodayKey();
                    return this.todayChecks[today]?.length || 0;
                },

                generateAvailableMonths() {
                    const months = [];
                    const currentDate = new Date();
                    const startDate = new Date('2025-07-01');
                    const endDate = new Date(currentDate.getFullYear(), currentDate.getMonth() + 6, 1);
                    
                    let tempDate = new Date(startDate);
                    while (tempDate <= endDate) {
                        const monthKey = tempDate.toISOString().slice(0, 7);
                        const monthLabel = tempDate.toLocaleDateString('id-ID', { 
                            year: 'numeric', 
                            month: 'long' 
                        });
                        
                        months.push({ value: monthKey, label: monthLabel });
                        tempDate.setMonth(tempDate.getMonth() + 1);
                    }
                    
                    this.availableMonths = months;
                },

                updateMonthlyView() {
                    // This function is called when user changes the selected month
                    // It ensures the monthly data structure exists for the selected month
                    if (!this.monthlyData[this.selectedMonth]) {
                        this.monthlyData[this.selectedMonth] = {
                            participantChecks: {},
                            khatamDays: []
                        };
                        
                        // Initialize all participants for this month
                        this.participants.forEach(participant => {
                            this.monthlyData[this.selectedMonth].participantChecks[participant.id] = [];
                        });
                    }
                },

                getParticipantMonthlyCount(participantId) {
                    const monthData = this.monthlyData[this.selectedMonth];
                    if (!monthData || !monthData.participantChecks[participantId]) {
                        return 0;
                    }
                    return monthData.participantChecks[participantId].length;
                },

                getMonthlyKhatam() {
                    const monthData = this.monthlyData[this.selectedMonth];
                    return monthData ? monthData.khatamDays.length : 0;
                },

                getTotalMonthlyChecks() {
                    const monthData = this.monthlyData[this.selectedMonth];
                    if (!monthData) return 0;
                    
                    let total = 0;
                    Object.values(monthData.participantChecks).forEach(checks => {
                        total += checks.length;
                    });
                    return total;
                },

                async saveData() {
                    // Always save to localStorage as backup
                    try {
                        localStorage.setItem('quranTrackerTodayChecks', JSON.stringify(this.todayChecks));
                        localStorage.setItem('quranTrackerMonthlyData', JSON.stringify(this.monthlyData));
                        localStorage.setItem('quranTrackerParticipants', JSON.stringify(this.participants));
                        console.log('‚úÖ Data saved to localStorage');
                    } catch (error) {
                        console.error('Error saving to localStorage:', error);
                    }
                },

                // Admin functions
                adminLogin() {
                    if (this.adminCredentials.username === 'admin' && this.adminCredentials.password === 'adminqu321') {
                        this.isAdmin = true;
                        this.showAdminLogin = false;
                        this.adminError = '';
                        this.adminCredentials = { username: '', password: '' };
                    } else {
                        this.adminError = 'Username atau password salah!';
                    }
                },

                logout() {
                    this.isAdmin = false;
                    this.activeTab = 'checklist';
                },

                generateWhatsAppExport() {
                    const now = new Date();
                    const jakartaTime = new Date(now.getTime() + (7 * 60 * 60 * 1000));
                    const dateStr = jakartaTime.toLocaleDateString('id-ID', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    const timeStr = jakartaTime.toLocaleTimeString('id-ID', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const rotatedParticipants = this.getRotatedParticipants();
                    const completedParticipants = [];
                    const pendingParticipants = [];
                    
                    rotatedParticipants.forEach((participant, index) => {
                        const juzNumber = index + 1;
                        const juzDetail = this.getJuzDetails(juzNumber);
                        const isCompleted = this.isCompleted(participant.id);
                        
                        const participantInfo = {
                            name: participant.name,
                            juz: juzNumber,
                            juzName: juzDetail.name,
                            content: juzDetail.content,
                            status: isCompleted ? '‚úÖ' : '‚è≥'
                        };
                        
                        if (isCompleted) {
                            completedParticipants.push(participantInfo);
                        } else {
                            pendingParticipants.push(participantInfo);
                        }
                    });
                    
                    let exportText = `üìñ *ONE DAY ONE JUZ TRACKER*\n`;
                    exportText += `üìÖ ${dateStr}\n`;
                    exportText += `üïê Update: ${timeStr} WIB\n`;
                    exportText += `üîÑ Sync: ${this.supabaseConnected ? 'Supabase Real-time' : 'Local Storage'}\n`;
                    exportText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
                    
                    exportText += `üìä *RINGKASAN PROGRESS*\n`;
                    exportText += `‚úÖ Sudah Selesai: ${completedParticipants.length}/30\n`;
                    exportText += `‚è≥ Belum Selesai: ${pendingParticipants.length}/30\n`;
                    
                    if (completedParticipants.length === 30) {
                        exportText += `üéâ *ALHAMDULILLAH KHATAM HARI INI!* üéâ\n`;
                    }
                    
                    exportText += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n`;
                    
                    if (completedParticipants.length > 0) {
                        exportText += `‚úÖ *SUDAH SELESAI (${completedParticipants.length})*\n`;
                        completedParticipants.forEach(p => {
                            exportText += `${p.status} ${p.name} - Juz ${p.juz} (${p.juzName})\n`;
                        });
                        exportText += `\n`;
                    }
                    
                    if (pendingParticipants.length > 0) {
                        exportText += `‚è≥ *BELUM SELESAI (${pendingParticipants.length})*\n`;
                        pendingParticipants.forEach(p => {
                            exportText += `${p.status} ${p.name} - Juz ${p.juz} (${p.juzName})\n`;
                            exportText += `    ${p.content}\n`;
                        });
                    }
                    
                    exportText += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                    exportText += `üíù Semoga Allah mudahkan kita semua dalam membaca Al-Qur'an\n`;
                    exportText += `ü§≤ Barakallahu fiikum\n\n`;
                    exportText += `#OneDayOneJuz #AlQuranTracker #Khatam`;
                    
                    this.exportText = exportText;
                },

                copyToClipboard() {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(this.exportText).then(() => {
                            alert('‚úÖ Data berhasil di-copy! Sekarang paste ke WhatsApp grup.');
                        }).catch(() => {
                            this.fallbackCopy();
                        });
                    } else {
                        this.fallbackCopy();
                    }
                },

                fallbackCopy() {
                    const textArea = document.createElement('textarea');
                    textArea.value = this.exportText;
                    document.body.appendChild(textArea);
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        alert('‚úÖ Data berhasil di-copy! Sekarang paste ke WhatsApp grup.');
                    } catch (err) {
                        alert('‚ùå Gagal copy. Silakan copy manual dari text box.');
                    }
                    document.body.removeChild(textArea);
                },

                resetSystem() {
                    if (!confirm('‚ö†Ô∏è PERINGATAN! Ini akan menghapus semua data progress.\n\nApakah Anda yakin?')) {
                        return;
                    }

                    if (!confirm('üö® KONFIRMASI TERAKHIR! Semua data akan hilang!\n\nLanjutkan reset?')) {
                        return;
                    }

                    this.isLoading = true;

                    try {
                        // Reset all data
                        this.todayChecks = {};
                        this.monthlyData = {};
                        this.exportText = '';

                        // Reset participants to default
                        this.participants = [
                            { id: 1, name: 'Ahmad' }, { id: 2, name: 'Fatimah' }, { id: 3, name: 'Abdullah' }, { id: 4, name: 'Khadijah' },
                            { id: 5, name: 'Umar' }, { id: 6, name: 'Aisha' }, { id: 7, name: 'Ali' }, { id: 8, name: 'Zainab' },
                            { id: 9, name: 'Yusuf' }, { id: 10, name: 'Maryam' }, { id: 11, name: 'Ibrahim' }, { id: 12, name: 'Hafsa' },
                            { id: 13, name: 'Khalid' }, { id: 14, name: 'Ruqayyah' }, { id: 15, name: 'Hamza' }, { id: 16, name: 'Ummu Kulthum' },
                            { id: 17, name: 'Bilal' }, { id: 18, name: 'Safiyyah' }, { id: 19, name: 'Salman' }, { id: 20, name: 'Sawdah' },
                            { id: 21, name: 'Talhah' }, { id: 22, name: 'Maymunah' }, { id: 23, name: 'Zaid' }, { id: 24, name: 'Juwayriyyah' },
                            { id: 25, name: 'Anas' }, { id: 26, name: 'Zaynab bint Jahsh' }, { id: 27, name: 'Mu\'adh' }, { id: 28, name: 'Ramlah' },
                            { id: 29, name: 'Sa\'d' }, { id: 30, name: 'Habibah' }
                        ];

                        // Clear localStorage
                        localStorage.removeItem('quranTrackerTodayChecks');
                        localStorage.removeItem('quranTrackerMonthlyData');
                        localStorage.removeItem('quranTrackerParticipants');
                        localStorage.removeItem('announcementLastSeen');

                        alert('‚úÖ Sistem berhasil direset! Halaman akan dimuat ulang.');
                        location.reload();
                        
                    } catch (error) {
                        console.error('Error resetting system:', error);
                        alert('‚ùå Terjadi kesalahan saat reset sistem.');
                    }
                    
                    this.isLoading = false;
                }
            }
        }
    </script>
</body>
</html>
